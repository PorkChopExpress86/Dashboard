services:
  dashboard:
    build: .
    image: homebrain-dashboard:local
    container_name: homebrain-dashboard
    ports:
      - "8000:8000"
    env_file:
      - .env
    environment:
      - APP_ENV=prod
      - CALENDAR_CACHE_DIR=/data/cache
    restart: unless-stopped
    volumes:
      - dashboard_data:/data
      - ./cache:/app/cache:ro

  selenium:
    image: selenium/standalone-chrome:118.0
    container_name: selenium-standalone
    ports:
      - "4444:4444"
    shm_size: 2g

  scraper:
    build:
      context: .
      dockerfile: Dockerfile.scraper
    image: homebrain-scraper:local
    container_name: schoolcafe-scraper
    working_dir: /work
    volumes:
      - ./:/work:rw
    depends_on:
      - selenium
    environment:
      - SELENIUM_REMOTE_URL=http://selenium:4444
      - TZ=America/Chicago
    restart: unless-stopped

volumes:
  dashboard_data:
